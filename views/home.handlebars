{{> top_nav}}
{{> modal}}

<script>
    const urlParams = new URLSearchParams(window.location.search)
    const action = urlParams.get('action')
    if (!!action && action === 'logout') {
        localStorage.removeItem('token')
        window.history.replaceState({}, document.title, '/')
    }

    var token = localStorage.getItem('token')
    if (!!token) {
        var appLink = document.getElementById('app-link')
        appLink.setAttribute('href', "{{appUrl}}" + "?token=" + token)
    }

    function openAuthModal (authAction) {
        const authModal = document.getElementById('auth-modal')
        const registrationForm = document.getElementById('registrationForm')
        const loginForm = document.getElementById('loginForm')

        if (authAction === 'register') {
            registrationForm.hidden = false
            loginForm.hidden = true
        }
        if (authAction === 'login') {
            registrationForm.hidden = true
            loginForm.hidden = false
        }
        authModal.hidden = false
    }

    function closeAuthModal () {
        const authModal = document.getElementById('auth-modal')
        authModal.hidden = true
    }

    var token = localStorage.getItem('token')
    if (!!token) {
        axios({
            method: 'post',
                url: '/api/auth/login-with-token',
                headers: {
                    token: token
                }
        }).then(res => {
            if (!!res.data.token) {
                var authNavItem = document.getElementById('auth-top-nav-item')
                var dashboardLinkNavItem = document.getElementById('dashboard-link-top-nav-item')
                authNavItem.hidden = true
                dashboardLinkNavItem.hidden = false
            }
        })
    }
</script>