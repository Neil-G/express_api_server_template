{{> top_nav}}
{{> modal}}

<script>
    // handle navigation from logout
    const urlParams = new URLSearchParams(window.location.search)
    const shouldRemoveToken = urlParams.get('logout')
    var authTokenKey = "{{authTokenKey}}"
    if (shouldRemoveToken) {
        localStorage.removeItem(authTokenKey)
        window.history.replaceState({}, document.title, '/')
    }

    // check for valid token
    var token = localStorage.getItem(authTokenKey)
    if (!!token) {
        axios({
            method: 'post',
                url: "{{loginWithTokenRoute}}",
                headers: {
                    [authTokenKey]: token
                }
        }).then(res => {
            if (!!res.data[authTokenKey]) {
                var authNavItem = document.getElementById('auth-top-nav-item')
                var dashboardLinkNavItem = document.getElementById('dashboard-link-top-nav-item')
                authNavItem.hidden = true
                dashboardLinkNavItem.hidden = false
                var appLink = document.getElementById('app-link')
                appLink.setAttribute('href', "{{appUrl}}" + '?'  + authTokenKey + '=' + token)
            }
        })
        
    }

    // open and close login and registration modals
    function openAuthModal (authAction) {
        const authModal = document.getElementById('auth-modal')
        const registrationForm = document.getElementById('registrationForm')
        const loginForm = document.getElementById('loginForm')

        if (authAction === 'register') {
            registrationForm.hidden = false
            loginForm.hidden = true
        }
        if (authAction === 'login') {
            registrationForm.hidden = true
            loginForm.hidden = false
        }
        authModal.hidden = false
    }

    function closeAuthModal () {
        const authModal = document.getElementById('auth-modal')
        authModal.hidden = true
    }
</script>